<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../polymer/lib/elements/dom-if.html">

<dom-module id="random-list">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <template is="dom-if" if="[[display]]">
      <p>List: [[list.length]] elements</p>
      <ul>
        <template is="dom-repeat" items="[[list]]">
            <li>[[item]]</li>
        </template>
      </ul>
      <p>Rest: [[rest.length]] elements</p>
      <ul>
        <template is="dom-repeat" items="[[rest]]">
            <li>[[item]]</li>
        </template>
      </ul>
      </template>
  </template>

  <script>
    /**
     * `random-list`
     * Returns the subset of a list of x elements from a larger source list.
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class RandomList extends Polymer.Element {
      static get is() { return 'random-list'; }
      static get properties() {
        return {
          display: {
            type: Boolean,
          },
          source: {
            type: Array,
            value: [],
          },
          max: {
            type: Number,
            value: 1,
          },
          list: {
            type: Array,
            value: [],
          },
          rest: {
            type: Array,
            value: [],
          },
        };
      }

      updateProperties(input) {
        const {
          display,
          source,
          max,
          list,
          rest,
        } = input;

        this.display = display;
        this.source = source;
        this.max = max;
        this.list = list;
        this.rest = rest;
      }

      pickRandomList(input) {
        let {
          display,
          source,
          max,
        } = input;

        if (!source || source.length === 0 || max === 0) {
          this.updateProperties({
            display,
            source: [],
            max,
            list: [],
            rest: []
          });

          return {
            list: [],
            rest: [],
          };
        }

        // Process the source.
        const rest = source
          .slice(0)
          .map(item => {
            if (typeof item === 'object') {
              return JSON.stringify(item);
            }
            return item;
          });

        // Start with an empty list that will be output.
        const list = [];

        for (let i = 0; i < max; i++) {
          // Pick a random element.
          const selection = rest[Math.floor(Math.random() * (rest.length - 1))];

          // Remove the random element from the source that will be output in the rest.
          rest.splice(rest.indexOf(selection), 1);

          // Add the random element to the list that will be output.
          list.push(selection);
        }

        // Output.
        this.updateProperties({
          display,
          source,
          max,
          list,
          rest,
        });

        return {
          list,
          rest,
        };
      }

      ready() {
        super.ready();

        this.pickRandomList({
          display: this.display,
          source: this.source,
          max: this.max,
        });
      }
    }

    window.customElements.define(RandomList.is, RandomList);
  </script>
</dom-module>
